<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Qu·∫£n l√Ω Hi·ªáu S√°ch</title>
<style>
body {
  font-family: Arial, sans-serif;
  background-color: #f4f4f4;
  margin: 0;
}
.navbar {
  overflow: hidden;
  background-color: #333;
}
.navbar a {
  float: left;
  color: white;
  padding: 14px 20px;
  text-decoration: none;
  text-align: center;
}
.navbar a:hover {
  background-color: #04AA6D;
}
.container {
  margin: 20px;
  background: white;
  padding: 20px;
  border-radius: 8px;
}
input, button {
  padding: 8px;
  margin: 5px 0;
}
table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 10px;
}
th, td {
  border: 1px solid #ccc;
  padding: 8px;
  text-align: left;
}
th {
  background-color: #04AA6D;
  color: white;
}
button {
  background-color: #04AA6D;
  border: none;
  color: white;
  cursor: pointer;
}
button:hover {
  background-color: #45a049;
}
hr {
  margin: 25px 0;
}
</style>
</head>
<body>

<div class="navbar">
  <a href="#books">üìö S√°ch</a>
  <a href="#inventory">üì¶ T·ªìn kho</a>
  <a href="#orders">üßæ ƒê∆°n h√†ng</a>
  <a href="#report">üìà B√°o c√°o</a>
</div>

<div class="container">
  <h2>Qu·∫£n l√Ω hi·ªáu s√°ch (D√†nh cho ng∆∞·ªùi b√°n)</h2>

  <!-- 1Ô∏è‚É£ QU·∫¢N L√ù DANH S√ÅCH S√ÅCH -->
  <h3 id="books">üìö Qu·∫£n l√Ω danh s√°ch s√°ch</h3>
  <form id="bookForm" onsubmit="saveBook(event)">
    <input type="hidden" id="editIndex">
    <label>T√™n s√°ch:</label><br>
    <input type="text" id="title" required><br>
    <label>T√°c gi·∫£:</label><br>
    <input type="text" id="author" required><br>
    <label>Gi√° (‚Ç´):</label><br>
    <input type="number" id="price" min="0" required><br>
    <label>S·ªë l∆∞·ª£ng:</label><br>
    <input type="number" id="quantity" min="0" required><br>
    <button type="submit">L∆∞u</button>
  </form>

  <table id="bookTable">
    <thead>
      <tr>
        <th>#</th>
        <th>T√™n s√°ch</th>
        <th>T√°c gi·∫£</th>
        <th>Gi√°</th>
        <th>S·ªë l∆∞·ª£ng</th>
        <th>Thao t√°c</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <hr>

  <!-- 2Ô∏è‚É£ QU·∫¢N L√ù T·ªíN KHO -->
  <h3 id="inventory">üì¶ Qu·∫£n l√Ω t·ªìn kho</h3>
  <table id="inventoryTable">
    <thead>
      <tr>
        <th>T√™n s√°ch</th>
        <th>T·ªìn kho</th>
        <th>Tr·∫°ng th√°i</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <hr>

  <!-- 3Ô∏è‚É£ QU·∫¢N L√ù ƒê∆†N H√ÄNG -->
  <h3 id="orders">üßæ Qu·∫£n l√Ω ƒë∆°n h√†ng</h3>
  <label>Ch·ªçn s√°ch:</label><br>
  <select id="orderBook"></select><br>
  <label>S·ªë l∆∞·ª£ng b√°n:</label><br>
  <input type="number" id="orderQty" min="1"><br>
  <button type="button" onclick="createOrder()">T·∫°o ƒë∆°n h√†ng</button>

  <table id="orderTable">
    <thead>
      <tr>
        <th>#</th>
        <th>T√™n s√°ch</th>
        <th>S·ªë l∆∞·ª£ng</th>
        <th>Th√†nh ti·ªÅn</th>
        <th>Ng√†y b√°n</th>
        <th>Thao t√°c</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <hr>

  <!-- 4Ô∏è‚É£ B√ÅO C√ÅO DOANH THU -->
  <h3 id="report">üìà B√°o c√°o doanh thu</h3>
  <p>T·ªïng ƒë∆°n h√†ng: <span id="totalOrders">0</span></p>
  <p>T·ªïng doanh thu: <span id="totalRevenue">0</span> ‚Ç´</p>

  <hr>
  <!-- N√∫t reset d·ªØ li·ªáu n·∫øu b·∫°n mu·ªën (t√πy ch·ªçn) -->
  <button type="button" onclick="resetData()">üóëÔ∏è X√≥a to√†n b·ªô d·ªØ li·ªáu</button>
</div>

<script>
// === Y√äU C·∫¶U B·∫†N: m·ªói l·∫ßn v√†o link th√¨ m·∫•t d·ªØ li·ªáu ===
// X√≥a d·ªØ li·ªáu ngay khi load trang
localStorage.removeItem("books");
localStorage.removeItem("orders");

// ================== KH·ªûI T·∫†O BI·∫æN TO√ÄN C·ª§C ==================
let books = [];
let orders = [];

// Tham chi·∫øu DOM (khai b√°o s·ªõm ƒë·ªÉ h√†m s·ª≠ d·ª•ng an to√†n)
const titleInput = document.getElementById("title");
const authorInput = document.getElementById("author");
const priceInput = document.getElementById("price");
const quantityInput = document.getElementById("quantity");
const editIndex = document.getElementById("editIndex");

// ================== QU·∫¢N L√ù S√ÅCH ==================
function saveBook(event) {
  event.preventDefault();
  const title = titleInput.value.trim();
  const author = authorInput.value.trim();
  const price = Number(priceInput.value);
  const quantity = Number(quantityInput.value);
  const index = editIndex.value;

  if (!title || !author || isNaN(price) || isNaN(quantity)) {
    alert("Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin h·ª£p l·ªá.");
    return;
  }

  if (index !== "") {
    // s·ª≠a
    books[index] = { title, author, price, quantity };
  } else {
    // th√™m
    books.push({ title, author, price, quantity });
  }

  // L∆∞u v√†o localStorage (m·∫∑c d√π sau khi load l·∫°i s·∫Ω b·ªã x√≥a nh∆∞ b·∫°n mu·ªën)
  localStorage.setItem("books", JSON.stringify(books));

  // reset form v√† hi·ªÉn th·ªã l·∫°i
  document.getElementById("bookForm").reset();
  editIndex.value = "";
  renderBooks();
  renderInventory();
  renderSelectBooks();
}

// ================== HI·ªÇN TH·ªä S√ÅCH ==================
function renderBooks() {
  const tbody = document.querySelector("#bookTable tbody");
  tbody.innerHTML = "";
  books.forEach((b, i) => {
    const row = `<tr>
      <td>${i + 1}</td>
      <td>${escapeHtml(b.title)}</td>
      <td>${escapeHtml(b.author)}</td>
      <td>${Number(b.price).toLocaleString("vi-VN")}</td>
      <td>${b.quantity}</td>
      <td>
        <button onclick="editBook(${i})">S·ª≠a</button>
        <button onclick="deleteBook(${i})">X√≥a</button>
      </td>
    </tr>`;
    tbody.innerHTML += row;
  });
}
function editBook(i) {
  const b = books[i];
  titleInput.value = b.title;
  authorInput.value = b.author;
  priceInput.value = b.price;
  quantityInput.value = b.quantity;
  editIndex.value = i;
}
function deleteBook(i) {
  if (confirm("X√≥a s√°ch n√†y?")) {
    books.splice(i, 1);
    localStorage.setItem("books", JSON.stringify(books));
    renderBooks();
    renderInventory();
    renderSelectBooks();
  }
}

// ================== T·ªíN KHO ==================
function renderInventory() {
  const tbody = document.querySelector("#inventoryTable tbody");
  tbody.innerHTML = "";
  books.forEach(b => {
    const status = b.quantity < 5 ? "‚ö† S·∫Øp h·∫øt h√†ng" : "‚úÖ C√≤n h√†ng";
    const row = `<tr>
      <td>${escapeHtml(b.title)}</td>
      <td>${b.quantity}</td>
      <td>${status}</td>
    </tr>`;
    tbody.innerHTML += row;
  });
}

// ================== ƒê∆†N H√ÄNG ==================
function renderSelectBooks() {
  const select = document.getElementById("orderBook");
  select.innerHTML = "";
  books.forEach((b, i) => {
    select.innerHTML += `<option value="${i}">${escapeHtml(b.title)}</option>`;
  });
}

function createOrder() {
  const sel = document.getElementById("orderBook");
  if (!sel || sel.options.length === 0) {
    alert("Ch∆∞a c√≥ s√°ch ƒë·ªÉ t·∫°o ƒë∆°n. Vui l√≤ng th√™m s√°ch tr∆∞·ªõc.");
    return;
  }
  const i = Number(sel.value);
  const qty = Number(document.getElementById("orderQty").value);
  if (!Number.isInteger(qty) || qty <= 0) {
    alert("S·ªë l∆∞·ª£ng kh√¥ng h·ª£p l·ªá!");
    return;
  }
  if (qty > books[i].quantity) {
    alert("S·ªë l∆∞·ª£ng b√°n v∆∞·ª£t qu√° t·ªìn kho!");
    return;
  }
  books[i].quantity -= qty;
  const total = qty * books[i].price;
  const date = new Date().toLocaleDateString("vi-VN");
  orders.push({ title: books[i].title, qty, total, date });

  localStorage.setItem("books", JSON.stringify(books));
  localStorage.setItem("orders", JSON.stringify(orders));

  renderBooks();
  renderInventory();
  renderSelectBooks();
  renderOrders();
  renderReport();
}

function renderOrders() {
  const tbody = document.querySelector("#orderTable tbody");
  tbody.innerHTML = "";
  orders.forEach((o, i) => {
    const row = `<tr>
      <td>${i + 1}</td>
      <td>${escapeHtml(o.title)}</td>
      <td>${o.qty}</td>
      <td>${Number(o.total).toLocaleString("vi-VN")}</td>
      <td>${o.date}</td>
      <td><button onclick="deleteOrder(${i})">X√≥a</button></td>
    </tr>`;
    tbody.innerHTML += row;
  });
}

function deleteOrder(i) {
  if (confirm("X√≥a ƒë∆°n h√†ng n√†y?")) {
    orders.splice(i, 1);
    localStorage.setItem("orders", JSON.stringify(orders));
    renderOrders();
    renderReport();
  }
}

// ================== B√ÅO C√ÅO ==================
function renderReport() {
  document.getElementById("totalOrders").textContent = orders.length;
  const revenue = orders.reduce((sum, o) => sum + (o.total || 0), 0);
  document.getElementById("totalRevenue").textContent = Number(revenue).toLocaleString("vi-VN");
}

// ================== H√ÄM TI·ªÜN √çCH ==================
function resetData() {
  if (confirm("B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a to√†n b·ªô d·ªØ li·ªáu kh√¥ng?")) {
    localStorage.removeItem("books");
    localStorage.removeItem("orders");
    books = [];
    orders = [];
    renderBooks();
    renderInventory();
    renderSelectBooks();
    renderOrders();
    renderReport();
    alert("D·ªØ li·ªáu ƒë√£ ƒë∆∞·ª£c x√≥a. B·∫°n c√≥ th·ªÉ nh·∫≠p m·ªõi t·ª´ ƒë·∫ßu.");
  }
}

// simple escape to avoid HTML injection when rendering
function escapeHtml(str) {
  return String(str)
    .replace(/&/g, "&amp;")
    .replace(/</g, "&lt;")
    .replace(/>/g, "&gt;")
    .replace(/"/g, "&quot;");
}

// ================== KH·ªûI T·∫†O HI·ªÇN TH·ªä BAN ƒê·∫¶U ==================
// Sau khi script ƒë√£ kh·ªüi t·∫°o bi·∫øn, g·ªçi render ƒë·ªÉ v·∫Ω giao di·ªán ban ƒë·∫ßu (r·ªóng)
renderBooks();
renderInventory();
renderSelectBooks();
renderOrders();
renderReport();

</script>
<script>
document.addEventListener("DOMContentLoaded", function () {
  const form = document.querySelector("form");
  const tableBody = document.querySelector("table tbody");

  form.addEventListener("submit", function (e) {
    e.preventDefault(); // ch·∫∑n reload trang

    // L·∫•y d·ªØ li·ªáu t·ª´ form
    const tenSach = form.querySelector('input[placeholder="T√™n s√°ch"]').value.trim();
    const tacGia = form.querySelector('input[placeholder="T√°c gi·∫£"]').value.trim();
    const gia = form.querySelector('input[placeholder="Gi√°"]').value.trim();
    const soLuong = form.querySelector('input[placeholder="S·ªë l∆∞·ª£ng"]').value.trim();

    // Ki·ªÉm tra d·ªØ li·ªáu
    if (!tenSach || !tacGia || !gia || !soLuong) {
      alert("Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß th√¥ng tin!");
      return;
    }

    // T·∫°o d√≤ng m·ªõi trong b·∫£ng
    const row = document.createElement("tr");
    row.innerHTML = `
      <td>${tableBody.rows.length + 1}</td>
      <td>${tenSach}</td>
      <td>${tacGia}</td>
      <td>${gia}</td>
      <td>${soLuong}</td>
      <td><button class="xoa">X√≥a</button></td>
    `;
    tableBody.appendChild(row);

    // Reset form
    form.reset();

    // G·∫Øn s·ª± ki·ªán x√≥a
    row.querySelector(".xoa").addEventListener("click", () => row.remove());
  });
});
</script>

</body>
</html>

